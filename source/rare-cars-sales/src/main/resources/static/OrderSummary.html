<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Order Summary</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .summary-item {
      display: flex;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid #eee;
      background: white;
    }
    .summary-item img {
      width: 120px;
      height: 80px;
      object-fit: cover;
      margin: 0 30px;
    }
    .totals-row {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .totals-box {
      border: 2px solid white;
      padding: 15px 20px;
      font-size: 18px;
      color: white;
      flex: 1;
    }
    .total-final {
      border: 2px solid white;
      padding: 15px 20px;
      font-size: 18px;
      background: white;
      color: black;
    }
  </style>
</head>
<body>

<header style="background-color: #D80000;">
  <div style="display: flex; align-items: center; gap: 20px;">
    <div class="logo">REV<span style="color: black;">LINE</span></div>
    <a href="index.html" class="btn" style="background: #D80000; color: white; border: 2px solid white;">Shop</a>
  </div>
  <a href="cart.html">
    <img src="https://img.icons8.com/ios-filled/50/ffffff/shopping-cart.png" width="30" height="30">
  </a>
</header>

<div class="checkout-box">
  <h2 style="font-weight: normal; font-size: 32px; margin-bottom: 20px;">Order Summary</h2>

  <div id="items-list" class="items-list">
    <p style="padding: 20px; color: #666;">Loading items...</p>
  </div>

  <div class="totals-row">
    <div class="totals-box">Subtotal: $<span id="subtotal">0.00</span></div>
    <div class="totals-box">Tax: $<span id="tax">0.00</span></div>
    <div class="totals-box">Shipping: $<span id="shipping">0.00</span></div>
  </div>

  <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
    <div class="total-final">Total: $<span id="total">0.00</span></div>
    <button class="btn btn-red" onclick="completeOrder()" style="padding: 18px 40px; font-size: 18px;">Complete Order</button>
  </div>
</div>

<script>
  var orderId = null;
  var orderData = null;

  window.onload = function() {
    var params = new URLSearchParams(window.location.search);
    orderId = params.get('id');

    if(!orderId) {
      document.getElementById('items-list').innerHTML = '<p style="padding: 20px; text-align: center; color: red;">No order ID provided</p>';
      return;
    }

    loadOrder();
  }

  function loadOrder() {
    fetch('/api/order/' + orderId)
            .then(function(res) {
              if(!res.ok) throw new Error("Order not found");
              return res.json();
            })
            .then(function(data) {
              console.log("Order data:", data);
              orderData = data;
              showOrder();
            })
            .catch(function(err) {
              console.log("Error loading order:", err);
              document.getElementById('items-list').innerHTML = '<p style="padding: 20px; text-align: center; color: red;">Error loading order: ' + err.message + '</p>';
            });
  }

  function showOrder() {
    var container = document.getElementById('items-list');
    container.innerHTML = '';

    if(!orderData.orderItems || orderData.orderItems.length == 0) {
      container.innerHTML = '<p style="padding: 20px; text-align: center;">No items in this order</p>';
      return;
    }

    for(var i = 0; i < orderData.orderItems.length; i++) {
      var item = orderData.orderItems[i];
      var car = item.car;

      var div = document.createElement('div');
      div.className = 'summary-item';
      div.innerHTML = '<span style="flex: 1; font-size: 16px;">' + car.year + ' ' + car.make + ' ' + car.model + '</span>' +
              '<img src="' + car.imagePath + '" alt="' + car.model + '">' +
              '<span style="font-size: 16px; min-width: 100px; text-align: right;">$' + car.price.toLocaleString(undefined, {minimumFractionDigits: 2}) + '</span>';
      container.appendChild(div);
    }
    document.getElementById('subtotal').innerText = orderData.subTotal.toLocaleString(undefined, {minimumFractionDigits: 2});
    document.getElementById('tax').innerText = orderData.tax.toLocaleString(undefined, {minimumFractionDigits: 2});
    document.getElementById('shipping').innerText = orderData.shippingFee.toLocaleString(undefined, {minimumFractionDigits: 2});
    document.getElementById('total').innerText = orderData.total.toLocaleString(undefined, {minimumFractionDigits: 2});
  }

  function completeOrder() {
    var total = document.getElementById('total').innerText;
    window.location.href = "Receipt.html?id=" + orderId + "&total=" + total;
  }
</script>

</body>
</html>